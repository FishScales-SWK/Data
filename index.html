<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏£‡∏∞‡∏ö‡∏ö‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ - SWK FishScales</title>
    
    <!-- Libraries -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <!-- Tailwind Config -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: { sans: ['Prompt', 'sans-serif'] },
                    colors: {
                        brand: { 50: '#f0f9ff', 100: '#e0f2fe', 500: '#0ea5e9', 600: '#0284c7', 800: '#075985', 900: '#0c4a6e' }
                    }
                }
            }
        }
    </script>

    <!-- Custom CSS -->
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;500;600;700&display=swap');
        body { font-family: 'Prompt', sans-serif; background-color: #f3f4f6; }
        
        /* Scrollbar */
        .custom-scrollbar::-webkit-scrollbar { height: 6px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: #f1f5f9; border-radius: 4px; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover { background: #94a3b8; }

        /* Loader */
        .loader { border: 4px solid #f3f3f3; border-top: 4px solid #3498db; border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        /* Hide Number Input Spinners */
        input[type=number]::-webkit-outer-spin-button,
        input[type=number]::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }
        input[type=number] { -moz-appearance: textfield; }
    </style>
</head>
<body>

    <!-- ‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏õ‡∏¥‡∏î Dashboard (‡∏à‡∏≥‡∏•‡∏≠‡∏á - ‡πÄ‡∏ú‡∏∑‡πà‡∏≠‡∏Å‡∏£‡∏ì‡∏µ‡∏õ‡∏¥‡∏î Modal ‡πÑ‡∏õ‡πÅ‡∏•‡πâ‡∏ß‡∏≠‡∏¢‡∏≤‡∏Å‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏´‡∏°‡πà) -->
    <div class="fixed bottom-8 right-8 z-40">
        <button onclick="openAdminModal()" class="bg-brand-600 text-white px-6 py-3 rounded-full shadow-lg hover:bg-brand-800 transition flex items-center gap-2">
            <i class="fa-solid fa-chart-pie"></i> ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤
        </button>
    </div>

    <!-- ADMIN IMAGE MODAL (‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏Ç‡∏¢‡∏≤‡∏¢) -->
    <div id="admin-image-modal" class="fixed inset-0 z-[120] hidden bg-black/90 flex items-center justify-center p-4 backdrop-blur-md" onclick="closeAdminImageModal()">
        <button class="absolute top-6 right-6 text-white text-4xl hover:text-gray-300 focus:outline-none z-[121]">&times;</button>
        <div id="admin-image-container" class="max-h-[90vh] max-w-[90vw] overflow-auto flex flex-col gap-4 items-center" onclick="event.stopPropagation()"></div>
    </div>

    <!-- ADMIN MODAL (Dashboard ‡∏´‡∏•‡∏±‡∏Å) -->
    <div id="admin-modal" class="fixed inset-0 z-[110] hidden bg-black/80 flex items-center justify-center p-0 md:p-4 backdrop-blur-sm opacity-0 transition-opacity duration-300">
        <div class="w-full h-full md:rounded-2xl shadow-2xl overflow-hidden relative flex flex-col transform scale-100 md:scale-95 transition-transform duration-300 bg-white">
            
            <!-- Login Screen -->
            <div id="admin-login-screen" class="absolute inset-0 bg-white z-[60] flex flex-col items-center justify-center p-8">
                <div class="w-full max-w-sm text-center">
                    <div class="mb-6 inline-block p-4 rounded-full bg-brand-100 text-brand-600"><i class="fa-solid fa-shield-halved text-4xl"></i></div>
                    <h3 class="text-2xl font-bold text-gray-800 mb-2">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•</h3>
                    <p class="text-gray-500 mb-6 text-sm">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</p>
                    <form onsubmit="adminLogin(event)" class="space-y-4">
                        <input type="password" id="admin-pass" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-brand-500 outline-none text-center tracking-widest text-lg" placeholder="‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô" required>
                        <button type="submit" class="w-full bg-brand-900 text-white font-bold py-3 rounded-lg hover:bg-brand-800 transition shadow-lg">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</button>
                    </form>
                    <button onclick="closeAdminModal()" class="mt-4 text-gray-400 hover:text-gray-600 text-sm">‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡πà‡∏≤‡∏á</button>
                </div>
            </div>

            <!-- Loading Overlay -->
            <div id="loading-overlay" class="absolute inset-0 bg-black/50 z-[55] hidden flex-col items-center justify-center text-white">
                <div class="loader mb-4"></div>
                <p id="loading-text" class="text-lg font-medium">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£...</p>
            </div>

            <!-- View 1: Production (‡∏õ‡∏£‡∏¥‡∏°‡∏≤‡∏ì‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤) -->
            <div id="view-production" class="min-h-full bg-gradient-to-br from-emerald-100 to-green-200 p-4 md:p-8 relative overflow-y-auto">
                <button onclick="switchAdminTab('inventory')" class="fixed top-4 right-4 md:top-8 md:right-8 z-50 bg-gradient-to-r from-blue-500 to-indigo-600 text-white px-5 py-3 rounded-full font-semibold shadow-lg hover:shadow-xl transform hover:scale-105 transition-all duration-300 flex items-center gap-2">
                    <i class="fa-solid fa-file-lines"></i> <span class="hidden sm:inline">‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</span>
                </button>
                <button onclick="closeAdminModal()" class="fixed top-4 left-4 z-50 bg-white/50 hover:bg-white p-3 rounded-full shadow-md transition text-gray-700"><i class="fa-solid fa-arrow-left"></i></button>
                
                <div class="max-w-7xl mx-auto space-y-8 pt-16 md:pt-10">
                    <div class="text-center">
                        <h1 class="text-4xl md:text-6xl font-black text-gray-800 mb-2">‡∏õ‡∏£‡∏¥‡∏°‡∏≤‡∏ì‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</h1>
                        <p class="text-lg md:text-xl text-gray-600">‡πÄ‡∏Å‡∏•‡πá‡∏î‡∏õ‡∏•‡∏≤‡∏ï‡∏≤‡∏Å‡πÅ‡∏´‡πâ‡∏á</p>
                    </div>
                    
                    <!-- Stats Cards -->
                    <div class="flex flex-wrap justify-center gap-4">
                        <div class="bg-gradient-to-br from-emerald-100 to-emerald-200 border border-emerald-300 p-6 rounded-3xl shadow-xl flex-1 min-w-[280px] h-40 relative flex flex-col">
                            <div class="flex justify-between items-start z-10"><h3 class="text-lg md:text-xl font-semibold text-emerald-800">‡∏ó‡∏≥‡πÑ‡∏î‡πâ‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</h3><div class="bg-emerald-500 p-2 rounded-full text-white"><i class="fa-solid fa-box-open"></i></div></div>
                            <div class="flex-grow flex items-center justify-center"><p class="text-5xl md:text-6xl font-bold text-emerald-900" id="prod-today">0</p></div>
                            <div class="absolute bottom-4 right-6 z-10"><span class="text-lg text-emerald-700 font-bold">‡∏Å‡∏£‡∏∞‡∏™‡∏≠‡∏ö</span></div>
                        </div>
                        <div class="bg-gradient-to-br from-violet-100 to-violet-200 border border-violet-300 p-6 rounded-3xl shadow-xl flex-1 min-w-[280px] h-40 relative flex flex-col">
                            <div class="flex justify-between items-start z-10"><h3 class="text-lg md:text-xl font-semibold text-violet-800">‡∏ó‡∏≥‡πÑ‡∏î‡πâ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏ô‡∏µ‡πâ</h3><div class="bg-violet-500 p-2 rounded-full text-white"><i class="fa-solid fa-calendar-days"></i></div></div>
                            <div class="flex-grow flex items-center justify-center"><p class="text-5xl md:text-6xl font-bold text-violet-900" id="prod-month">0</p></div>
                            <div class="absolute bottom-4 right-6 z-10"><span class="text-lg text-violet-700 font-bold">‡∏Å‡∏£‡∏∞‡∏™‡∏≠‡∏ö</span></div>
                        </div>
                        <div class="bg-gradient-to-br from-sky-100 to-sky-200 border border-sky-300 p-6 rounded-3xl shadow-xl flex-1 min-w-[280px] h-40 relative flex flex-col">
                            <div class="flex justify-between items-start z-10"><h3 class="text-lg md:text-xl font-semibold text-sky-800">‡∏Ç‡∏≠‡∏á‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏™‡πà‡∏á</h3><div class="bg-sky-500 p-2 rounded-full text-white"><i class="fa-solid fa-arrow-trend-up"></i></div></div>
                            <div class="flex-grow flex items-center justify-center"><p class="text-5xl md:text-6xl font-bold text-sky-900" id="prod-stock">0</p></div>
                            <div class="absolute bottom-4 right-6 z-10"><span class="text-lg text-sky-700 font-bold">‡∏Å‡∏£‡∏∞‡∏™‡∏≠‡∏ö</span></div>
                        </div>
                    </div>

                    <!-- Input Form -->
                    <div class="bg-white backdrop-blur-sm rounded-3xl shadow-xl border border-white/20 p-8 md:p-10">
                        <div class="flex items-center gap-3 mb-8">
                            <div class="bg-gradient-to-r from-emerald-500 to-teal-600 p-3 rounded-2xl text-white"><i class="fa-solid fa-flask text-xl"></i></div>
                            <h2 class="text-3xl md:text-4xl font-bold bg-gradient-to-r from-emerald-600 to-teal-600 bg-clip-text text-transparent">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏ú‡∏•‡∏¥‡∏ï‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</h2>
                        </div>
                        <div class="flex flex-col items-center gap-6">
                            <div class="flex items-center justify-center gap-4 w-full max-w-md">
                                <label class="text-xl font-semibold text-slate-700 hidden md:block">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô:</label>
                                <input type="number" id="input-prod-today" class="w-full md:w-48 px-4 py-4 text-3xl font-bold text-center border-2 border-gray-300 rounded-2xl focus:ring-4 focus:ring-emerald-200 focus:border-emerald-500 outline-none transition bg-white" placeholder="0">
                                <span class="text-xl font-semibold text-slate-700">‡∏Å‡∏£‡∏∞‡∏™‡∏≠‡∏ö</span>
                            </div>
                            <button onclick="submitProduction()" class="w-full max-w-md py-4 bg-gradient-to-r from-emerald-500 to-teal-600 hover:from-emerald-600 hover:to-teal-700 text-white text-xl font-bold rounded-2xl shadow-lg transform active:scale-95 transition-all">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
                        </div>
                    </div>

                    <!-- Table -->
                    <div class="bg-white backdrop-blur-sm rounded-3xl shadow-xl border border-white/20 p-8 md:p-10">
                        <div class="mb-6">
                            <div class="flex items-center gap-3 mb-4">
                                <div class="bg-gradient-to-r from-emerald-500 to-teal-600 p-3 rounded-2xl text-white"><i class="fa-solid fa-clock-rotate-left text-xl"></i></div>
                                <h2 class="text-3xl md:text-4xl font-bold bg-gradient-to-r from-emerald-600 to-teal-600 bg-clip-text text-transparent">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ú‡∏•‡∏¥‡∏ï‡∏¢‡πâ‡∏≠‡∏ô‡∏´‡∏•‡∏±‡∏á</h2>
                            </div>
                            <div class="flex gap-2">
                                <label class="self-center text-gray-600 font-medium">‡∏ï‡∏±‡∏ß‡∏Å‡∏£‡∏≠‡∏á:</label>
                                <select id="prod-filter-year" onchange="renderProductionView()" class="px-3 py-2 border rounded-lg focus:ring-2 focus:ring-emerald-500 text-sm md:text-base bg-white"></select>
                                <select id="prod-filter-month" onchange="renderProductionView()" class="px-3 py-2 border rounded-lg focus:ring-2 focus:ring-emerald-500 text-sm md:text-base bg-white"></select>
                            </div>
                        </div>
                        <div class="overflow-auto max-h-[400px] rounded-xl border border-gray-200 bg-white">
                            <table class="w-full text-left">
                                <thead class="bg-gray-100 text-gray-600 text-sm sticky top-0 font-semibold">
                                    <tr><th class="p-4 text-center">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà/‡πÄ‡∏ß‡∏•‡∏≤</th><th class="p-4 text-center">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Å‡∏£‡∏∞‡∏™‡∏≠‡∏ö‡∏ó‡∏µ‡πà‡∏ú‡∏•‡∏¥‡∏ï‡πÑ‡∏î‡πâ</th><th class="p-4 text-center">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô (KG)</th><th class="p-4"></th></tr>
                                </thead>
                                <tbody id="table-production-body" class="divide-y divide-gray-100 text-gray-700"></tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Chart -->
                    <div class="bg-white backdrop-blur-sm rounded-3xl shadow-xl border border-white/20 p-8 md:p-10 mt-8">
                        <div class="flex flex-col gap-4 mb-6">
                            <div class="flex items-center gap-3">
                                <div class="bg-gradient-to-r from-emerald-500 to-teal-600 p-3 rounded-2xl text-white"><i class="fa-solid fa-chart-column text-xl"></i></div>
                                <h2 class="text-3xl md:text-4xl font-bold bg-gradient-to-r from-emerald-600 to-teal-600 bg-clip-text text-transparent">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡∏≥‡πÑ‡∏î‡πâ‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô</h2>
                            </div>
                            <div class="flex flex-wrap gap-4 items-center bg-gray-50 p-3 rounded-xl border border-gray-100">
                                <div class="flex items-center gap-2">
                                    <span class="text-sm font-medium text-gray-700">‡∏õ‡∏µ:</span>
                                    <select id="prod-daily-filter-year" onchange="renderDailyProductionChart()" class="px-3 py-1.5 border rounded-lg focus:ring-2 focus:ring-emerald-500 text-sm bg-white min-w-[80px]"></select>
                                </div>
                                <div class="flex items-center gap-2">
                                    <input type="checkbox" id="chk-daily-month" checked onchange="toggleDailyChartFilters()" class="w-5 h-5 text-emerald-600 rounded focus:ring-emerald-500 border-gray-300">
                                    <label for="chk-daily-month" class="text-sm font-medium text-gray-700">‡πÄ‡∏î‡∏∑‡∏≠‡∏ô:</label>
                                    <select id="prod-daily-filter-month" onchange="renderDailyProductionChart()" class="px-3 py-1.5 border rounded-lg focus:ring-2 focus:ring-emerald-500 text-sm bg-white min-w-[100px]"></select>
                                </div>
                            </div>
                        </div>
                        <div class="flex w-full h-[450px] border border-gray-100 rounded-xl overflow-hidden relative bg-white">
                            <div class="w-[80px] h-full flex-shrink-0 relative z-20 bg-white pb-12">
                                <div id="chart-daily-y" class="absolute -top-3 -left-2 w-[90px] h-full"></div> 
                            </div>
                            <div id="daily-chart-scroller" class="flex-grow h-full overflow-x-auto overflow-y-hidden relative z-10 bg-white custom-scrollbar pb-12"> 
                                <div id="chart-daily-production" class="h-full"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- View 2: Inventory (‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤) -->
            <div id="view-inventory" class="min-h-full bg-gradient-to-br from-blue-100 to-indigo-200 p-4 md:p-8 relative overflow-y-auto hidden">
                <button onclick="switchAdminTab('production')" class="fixed top-4 right-4 md:top-8 md:right-8 z-50 bg-white/80 hover:bg-white text-gray-700 px-6 py-2 rounded-lg font-medium transition-colors flex items-center gap-2 shadow-sm">
                    <i class="fa-solid fa-arrow-left"></i> ‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤‡∏õ‡∏£‡∏¥‡∏°‡∏≤‡∏ì‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤
                </button>
                
                <div class="max-w-7xl mx-auto space-y-8 pt-16 md:pt-10">
                    <div class="text-center">
                        <h1 class="text-4xl md:text-6xl font-black text-gray-800 mb-2">‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</h1>
                        <p class="text-lg md:text-xl text-gray-600">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏™‡∏ï‡πá‡∏≠‡∏Å ‡∏ã‡∏∑‡πâ‡∏≠‡πÄ‡∏Ç‡πâ‡∏≤ - ‡∏Ç‡∏≤‡∏¢‡∏≠‡∏≠‡∏Å</p>
                    </div>
                    
                    <!-- Stats Cards -->
                    <div class="flex flex-wrap justify-center gap-4">
                        <div class="bg-gradient-to-br from-green-100 to-green-200 border border-green-300 p-6 rounded-3xl shadow-xl flex-1 min-w-[280px] h-40 relative flex flex-col">
                            <div class="flex justify-between items-start z-10"><h3 class="text-xl font-semibold text-green-800">‡∏ã‡∏∑‡πâ‡∏≠‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏ô‡∏µ‡πâ</h3><div class="bg-green-500 p-2 rounded-full text-white"><i class="fa-solid fa-arrow-trend-up"></i></div></div>
                            <div class="flex-grow flex items-center justify-center"><p class="text-5xl md:text-6xl font-bold text-green-900" id="inv-in">0</p></div>
                            <div class="absolute bottom-4 right-6 z-10"><span class="text-lg text-green-700 font-medium">KG</span></div>
                        </div>
                        <div class="bg-gradient-to-br from-blue-100 to-blue-200 border border-blue-300 p-6 rounded-3xl shadow-xl flex-1 min-w-[280px] h-40 relative flex flex-col">
                            <div class="flex justify-between items-start z-10"><h3 class="text-xl font-semibold text-blue-800">‡∏Ç‡∏≤‡∏¢‡∏≠‡∏≠‡∏Å‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏ô‡∏µ‡πâ</h3><div class="bg-blue-500 p-2 rounded-full text-white"><i class="fa-solid fa-arrow-trend-down"></i></div></div>
                            <div class="flex-grow flex items-center justify-center"><p class="text-5xl md:text-6xl font-bold text-blue-900" id="inv-out">0</p></div>
                            <div class="absolute bottom-4 right-6 z-10"><span class="text-lg text-blue-700 font-medium">KG</span></div>
                        </div>
                        <div class="bg-gradient-to-br from-amber-100 to-amber-200 border border-amber-300 p-6 rounded-3xl shadow-xl flex-1 min-w-[280px] h-40 relative flex flex-col">
                            <div class="flex justify-between items-start z-10"><h3 class="text-xl font-semibold text-amber-800">‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠</h3><div class="bg-amber-500 p-2 rounded-full text-white"><i class="fa-solid fa-layer-group"></i></div></div>
                            <div class="flex-grow flex items-center justify-center"><p class="text-5xl md:text-6xl font-bold text-amber-900" id="inv-raw-material">0</p></div>
                            <div class="absolute bottom-4 right-6 z-10"><span class="text-lg text-amber-700 font-medium">KG</span></div>
                        </div>
                        <div class="bg-gradient-to-br from-violet-100 to-violet-200 border border-violet-300 p-6 rounded-3xl shadow-xl flex-1 min-w-[280px] h-40 relative flex flex-col">
                            <div class="flex justify-between items-start z-10"><h3 class="text-xl font-semibold text-violet-800">‡∏Ç‡∏≠‡∏á‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏™‡πà‡∏á</h3><div class="bg-violet-500 p-2 rounded-full text-white"><i class="fa-solid fa-box-open"></i></div></div>
                            <div class="flex-grow flex items-center justify-center"><p class="text-5xl md:text-6xl font-bold text-violet-900" id="inv-stock">0</p></div>
                            <div class="absolute bottom-4 right-6 z-10"><span class="text-lg text-violet-700 font-medium">‡∏Å‡∏£‡∏∞‡∏™‡∏≠‡∏ö</span></div>
                        </div>
                    </div>

                    <!-- Input Form -->
                    <div class="bg-white backdrop-blur-sm rounded-3xl shadow-xl border border-white/20 p-8 md:p-10">
                        <div class="flex items-center gap-3 mb-8">
                            <div class="bg-gradient-to-r from-blue-500 to-purple-600 p-3 rounded-2xl text-white"><i class="fa-solid fa-file-pen text-xl"></i></div>
                            <h2 class="text-3xl md:text-4xl font-bold bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</h2>
                        </div>
                        <form onsubmit="submitInventory(event)" class="space-y-6">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div class="space-y-2">
                                    <label class="font-semibold text-slate-700 text-lg">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</label>
                                    <select id="inv-type" onchange="toggleInvForm(this.value)" class="w-full px-4 py-4 border-2 rounded-2xl focus:ring-4 focus:ring-blue-200 focus:border-blue-500 outline-none text-lg bg-gray-50">
                                        <option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ --</option>
                                        <option value="‡∏ã‡∏∑‡πâ‡∏≠‡πÄ‡∏Ç‡πâ‡∏≤" class="text-green-600">üì¶ ‡∏ã‡∏∑‡πâ‡∏≠‡πÄ‡∏Ç‡πâ‡∏≤</option>
                                        <option value="‡∏Ç‡∏≤‡∏¢‡∏≠‡∏≠‡∏Å" class="text-blue-600">üöõ ‡∏Ç‡∏≤‡∏¢‡∏≠‡∏≠‡∏Å</option>
                                    </select>
                                </div>
                                <div class="space-y-2">
                                    <label class="font-semibold text-slate-700 text-lg">‡∏ä‡∏∑‡πà‡∏≠‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤/‡∏ú‡∏π‡πâ‡∏Ç‡∏≤‡∏¢</label>
                                    <input type="text" id="inv-name" class="w-full px-4 py-4 border-2 rounded-2xl focus:ring-4 focus:ring-blue-200 focus:border-blue-500 outline-none text-lg" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠...">
                                </div>
                            </div>
                            <div id="inv-bags-container" class="space-y-2 hidden">
                                <label class="font-semibold text-slate-700 text-lg">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô (‡∏Å‡∏£‡∏∞‡∏™‡∏≠‡∏ö)</label>
                                <div class="relative">
                                    <input type="number" id="inv-bags-input" class="w-full px-4 py-4 pr-16 border-2 rounded-2xl focus:ring-4 focus:ring-blue-200 focus:border-blue-500 outline-none text-lg" placeholder="0">
                                    <span class="absolute right-4 top-1/2 -translate-y-1/2 text-gray-500 font-bold">‡∏Å‡∏£‡∏∞‡∏™‡∏≠‡∏ö</span>
                                </div>
                            </div>
                            <div class="space-y-2">
                                <label class="font-semibold text-slate-700 text-lg" id="inv-qty-label">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô (‡∏Å‡∏¥‡πÇ‡∏•‡∏Å‡∏£‡∏±‡∏°)</label>
                                <div class="relative">
                                    <input type="number" id="inv-qty" step="0.01" class="w-full px-4 py-4 pr-16 border-2 rounded-2xl focus:ring-4 focus:ring-blue-200 focus:border-blue-500 outline-none text-lg" placeholder="0.00">
                                    <span class="absolute right-4 top-1/2 -translate-y-1/2 text-gray-500 font-bold" id="inv-unit">KG</span>
                                </div>
                            </div>
                            <div class="space-y-2">
                                <label class="font-semibold text-slate-700 text-lg">‡πÅ‡∏ô‡∏ö‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û (‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î 2 ‡∏£‡∏π‡∏õ)</label>
                                <div class="border-2 border-dashed border-gray-300 rounded-2xl p-6 text-center hover:bg-gray-50 transition cursor-pointer relative">
                                    <input type="file" id="inv-images" multiple accept="image/*" class="absolute inset-0 opacity-0 cursor-pointer" onchange="handleImagePreview(this)">
                                    <div id="image-upload-placeholder"><i class="fa-solid fa-cloud-arrow-up text-3xl text-gray-400 mb-2"></i><p class="text-gray-500">‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û</p></div>
                                    <div id="image-preview-container" class="hidden grid grid-cols-2 gap-4 mt-2"></div>
                                </div>
                            </div>
                            <button type="submit" class="w-full py-4 bg-gradient-to-r from-blue-500 to-purple-600 hover:from-blue-600 hover:to-purple-700 text-white font-bold rounded-2xl shadow-lg text-xl transform active:scale-95 transition-all">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</button>
                        </form>
                    </div>

                    <!-- Table -->
                    <div class="bg-white backdrop-blur-sm rounded-3xl shadow-xl border border-white/20 p-8 md:p-10">
                        <div class="flex flex-col gap-4 mb-8">
                            <div class="flex items-center gap-3">
                                <div class="bg-gradient-to-r from-indigo-500 to-purple-600 p-3 rounded-2xl text-white"><i class="fa-solid fa-table-list text-xl"></i></div>
                                <h2 class="text-3xl md:text-4xl font-bold bg-gradient-to-r from-indigo-600 to-purple-600 bg-clip-text text-transparent">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</h2>
                            </div>
                            <div class="flex gap-3 flex-wrap items-center bg-gray-50 p-3 rounded-xl border border-gray-100 self-start">
                                <select id="inv-filter-year" onchange="renderInventoryView()" class="px-3 py-1.5 border rounded-lg focus:ring-2 focus:ring-indigo-500 text-sm bg-white"></select>
                                <select id="inv-filter-month" onchange="renderInventoryView()" class="px-3 py-1.5 border rounded-lg focus:ring-2 focus:ring-indigo-500 text-sm bg-white"></select>
                                <select id="inv-filter-status" onchange="renderInventoryView()" class="px-3 py-1.5 border rounded-lg focus:ring-2 focus:ring-indigo-500 text-sm bg-white">
                                    <option value="">‡∏ó‡∏∏‡∏Å‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</option>
                                    <option value="‡∏ã‡∏∑‡πâ‡∏≠‡πÄ‡∏Ç‡πâ‡∏≤">‡∏ã‡∏∑‡πâ‡∏≠‡πÄ‡∏Ç‡πâ‡∏≤</option>
                                    <option value="‡∏Ç‡∏≤‡∏¢‡∏≠‡∏≠‡∏Å" class="text-blue-600 font-medium">‡∏Ç‡∏≤‡∏¢‡∏≠‡∏≠‡∏Å</option>
                                </select>
                            </div>
                        </div>
                        <div class="overflow-auto max-h-[500px] rounded-xl border border-gray-200 bg-white mb-8">
                            <table class="w-full text-left border-collapse">
                                <thead class="bg-gray-100 text-gray-600 text-base sticky top-0 font-semibold z-10">
                                    <tr>
                                        <th class="p-4 whitespace-nowrap">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà/‡πÄ‡∏ß‡∏•‡∏≤</th>
                                        <th class="p-4">‡∏ä‡∏∑‡πà‡∏≠/‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
                                        <th class="p-4 text-center">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô (KG)</th>
                                        <th class="p-4 text-center">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î</th>
                                        <th class="p-4"></th>
                                    </tr>
                                </thead>
                                <tbody id="table-inv-body" class="divide-y divide-gray-100 text-gray-700"></tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Chart -->
                    <div class="bg-white backdrop-blur-sm rounded-3xl shadow-xl border border-white/20 p-8 md:p-10">
                        <div class="flex flex-col gap-4 mb-6">
                            <div class="flex items-center gap-3">
                                <div class="bg-gradient-to-r from-indigo-500 to-purple-600 p-3 rounded-2xl text-white"><i class="fa-solid fa-chart-bar text-xl"></i></div>
                                <h2 class="text-3xl md:text-4xl font-bold bg-gradient-to-r from-indigo-600 to-purple-600 bg-clip-text text-transparent">‡∏õ‡∏£‡∏¥‡∏°‡∏≤‡∏ì‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ (‡∏ã‡∏∑‡πâ‡∏≠‡πÄ‡∏Ç‡πâ‡∏≤/‡∏Ç‡∏≤‡∏¢‡∏≠‡∏≠‡∏Å)</h2>
                            </div>
                            <div class="flex flex-wrap gap-4 items-center bg-gray-50 p-3 rounded-xl border border-gray-100">
                                <div class="flex items-center gap-2"><span class="text-sm font-medium text-gray-700">‡∏õ‡∏µ:</span><select id="inv-chart-filter-year" onchange="renderInventoryChart()" class="px-3 py-1.5 border rounded-lg focus:ring-2 focus:ring-indigo-500 text-sm bg-white min-w-[80px]"></select></div>
                                <div class="flex items-center gap-2"><input type="checkbox" id="chk-inv-chart-month" checked onchange="toggleInvChartFilters()" class="w-5 h-5 text-indigo-600 rounded focus:ring-indigo-500 border-gray-300"><label for="chk-inv-chart-month" class="text-sm font-medium text-gray-700">‡πÄ‡∏î‡∏∑‡∏≠‡∏ô:</label><select id="inv-chart-filter-month" onchange="renderInventoryChart()" class="px-3 py-1.5 border rounded-lg focus:ring-2 focus:ring-indigo-500 text-sm bg-white min-w-[100px]"></select></div>
                                <div class="flex items-center gap-2 ml-2 border-l pl-4 border-gray-300"><label class="text-sm font-medium text-gray-700">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞:</label><select id="inv-chart-filter-status" onchange="renderInventoryChart()" class="px-3 py-1.5 border rounded-lg focus:ring-2 focus:ring-indigo-500 text-sm bg-white"><option value="">‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</option><option value="‡∏ã‡∏∑‡πâ‡∏≠‡πÄ‡∏Ç‡πâ‡∏≤">‡∏ã‡∏∑‡πâ‡∏≠‡πÄ‡∏Ç‡πâ‡∏≤</option><option value="‡∏Ç‡∏≤‡∏¢‡∏≠‡∏≠‡∏Å">‡∏Ç‡∏≤‡∏¢‡∏≠‡∏≠‡∏Å</option></select></div>
                            </div>
                        </div>
                        <div class="flex w-full h-[450px] border border-gray-100 rounded-xl overflow-hidden relative bg-white">
                            <div class="w-[80px] h-full flex-shrink-0 relative z-20 bg-white pb-12"><div id="chart-inventory-y" class="absolute -top-3 -left-2 w-[90px] h-full"></div></div>
                            <div id="inventory-chart-scroller" class="flex-grow h-full overflow-x-auto overflow-y-hidden relative z-10 bg-white custom-scrollbar pb-2"><div id="chart-inventory" class="h-full"></div></div>
                        </div>
                        <div class="flex justify-center gap-8 mt-6 pt-4 border-t border-gray-100">
                            <div class="flex items-center gap-2"><span class="w-4 h-4 rounded-full bg-[#22c55e]"></span><span class="text-lg font-bold text-gray-700">‡∏ã‡∏∑‡πâ‡∏≠‡πÄ‡∏Ç‡πâ‡∏≤</span></div>
                            <div class="flex items-center gap-2"><span class="w-4 h-4 rounded-full bg-[#3b82f6]"></span><span class="text-lg font-bold text-gray-700">‡∏Ç‡∏≤‡∏¢‡∏≠‡∏≠‡∏Å</span></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Logic Script -->
    <script>
        const GOOGLE_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbyfxWs81WEsrizNnTi82tZAOH_EHX1hKnvUoqsARpYch3TTjEqz5oepiol_vWQ4lK3G0g/exec';
        let appData = { records: [], production: [] };
        let charts = { production: null, inventory: null, dailyProduction: null, dailyY: null, invMain: null, invY: null };
        let currentInvImages = []; 

        const getThaiMonthName = (m) => ['‡∏°‡∏Å‡∏£‡∏≤‡∏Ñ‡∏°','‡∏Å‡∏∏‡∏°‡∏†‡∏≤‡∏û‡∏±‡∏ô‡∏ò‡πå','‡∏°‡∏µ‡∏ô‡∏≤‡∏Ñ‡∏°','‡πÄ‡∏°‡∏©‡∏≤‡∏¢‡∏ô','‡∏û‡∏§‡∏©‡∏†‡∏≤‡∏Ñ‡∏°','‡∏°‡∏¥‡∏ñ‡∏∏‡∏ô‡∏≤‡∏¢‡∏ô','‡∏Å‡∏£‡∏Å‡∏é‡∏≤‡∏Ñ‡∏°','‡∏™‡∏¥‡∏á‡∏´‡∏≤‡∏Ñ‡∏°','‡∏Å‡∏±‡∏ô‡∏¢‡∏≤‡∏¢‡∏ô','‡∏ï‡∏∏‡∏•‡∏≤‡∏Ñ‡∏°','‡∏û‡∏§‡∏®‡∏à‡∏¥‡∏Å‡∏≤‡∏¢‡∏ô','‡∏ò‡∏±‡∏ô‡∏ß‡∏≤‡∏Ñ‡∏°'][m-1];
        
        const parseDate = (str) => {
            if (!str) return new Date();
            const parts = str.match(/(\d+)/g);
            if (parts && parts.length >= 3) {
                let p1 = parseInt(parts[0]), p2 = parseInt(parts[1]), p3 = parseInt(parts[2]);
                let day, month, year;
                if (p1 > 31) { year = p1; month = p2 - 1; day = p3; } else { day = p1; month = p2 - 1; year = p3; }
                if (year > 2400) year -= 543;
                const hour = parts[3] ? parseInt(parts[3]) : 0;
                const min = parts[4] ? parseInt(parts[4]) : 0;
                const sec = parts[5] ? parseInt(parts[5]) : 0;
                const d = new Date(year, month, day, hour, min, sec);
                if (!isNaN(d.getTime())) return d;
            }
            return new Date(str);
        };

        const calculateReadyStockBags = () => {
            const totalProd = appData.production.reduce((s, r) => s + (parseInt(r.bags) || 0), 0);
            const totalSold = appData.records.filter(r => r.status === '‡∏Ç‡∏≤‡∏¢‡∏≠‡∏≠‡∏Å').reduce((s, r) => {
                const soldBags = r.bags ? parseInt(r.bags) : (parseFloat(r.quantity) || 0) / 10;
                return s + soldBags;
            }, 0);
            return Math.max(0, totalProd - totalSold);
        };

        function openAdminModal() {
            const m = document.getElementById('admin-modal');
            document.getElementById('admin-login-screen').classList.remove('hidden');
            document.getElementById('admin-pass').value = '';
            m.classList.remove('hidden'); 
            setTimeout(() => { m.classList.remove('opacity-0'); m.firstElementChild.classList.remove('scale-95'); m.firstElementChild.classList.add('scale-100'); }, 10);
        }

        function closeAdminModal() {
            const m = document.getElementById('admin-modal'); 
            m.classList.add('opacity-0');
            m.firstElementChild.classList.remove('scale-100');
            m.firstElementChild.classList.add('scale-95');
            setTimeout(() => { m.classList.add('hidden'); }, 300);
        }

        function adminLogin(e) {
            e.preventDefault();
            const pass = document.getElementById('admin-pass').value;
            if (pass === '032489') { 
                const screen = document.getElementById('admin-login-screen');
                screen.classList.add('opacity-0', 'pointer-events-none');
                setTimeout(() => { screen.classList.add('hidden'); screen.classList.remove('opacity-0', 'pointer-events-none'); }, 300);
                populateFilterOptions();
                fetchData();
                switchAdminTab('production');
            } else {
                Swal.fire({ title: '‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á', icon: 'error', confirmButtonColor: '#0ea5e9' });
            }
        }

        function switchAdminTab(tabName) {
            document.getElementById('view-production').classList.add('hidden');
            document.getElementById('view-inventory').classList.add('hidden');
            document.getElementById(`view-${tabName}`).classList.remove('hidden');
            setTimeout(() => {
                if(tabName === 'production') { renderProductionView(); renderDailyProductionChart(); }
                if(tabName === 'inventory') { renderInventoryView(); renderInventoryChart(); }
            }, 100);
        }

        function populateFilterOptions() {
            const currentYear = new Date().getFullYear();
            const years = [];
            for (let y = 2020; y <= currentYear + 5; y++) years.push(y);
            years.reverse();

            const createOpts = (selId, items, def) => {
                const sel = document.getElementById(selId);
                if(!sel) return; 
                sel.innerHTML = `<option value="">${def}</option>`;
                items.forEach(i => {
                    const opt = document.createElement('option');
                    opt.value = i.value; opt.text = i.text;
                    sel.appendChild(opt);
                });
            };

            const yearOpts = years.map(y => ({value: y, text: y + 543}));
            const monthOpts = Array.from({length:12}, (_,i) => ({value: i+1, text: getThaiMonthName(i+1)}));

            ['prod-filter-year', 'inv-filter-year'].forEach(id => createOpts(id, yearOpts, '‡∏ó‡∏∏‡∏Å‡∏õ‡∏µ'));
            ['prod-filter-month', 'inv-filter-month'].forEach(id => createOpts(id, monthOpts, '‡∏ó‡∏∏‡∏Å‡πÄ‡∏î‡∏∑‡∏≠‡∏ô'));
            ['prod-daily-filter-year', 'inv-chart-filter-year'].forEach(id => createOpts(id, yearOpts, currentYear));
            
            const dailyMonthSel = document.getElementById('prod-daily-filter-month');
            if(dailyMonthSel) {
                dailyMonthSel.innerHTML = `<option value="all">‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</option>`;
                monthOpts.forEach(i => { dailyMonthSel.appendChild(new Option(i.text, i.value)); });
            }
            const invMonthSel = document.getElementById('inv-chart-filter-month');
            if(invMonthSel) {
                invMonthSel.innerHTML = `<option value="all">‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</option>`;
                monthOpts.forEach(i => { invMonthSel.appendChild(new Option(i.text, i.value)); });
            }

            const curMonth = new Date().getMonth() + 1;
            ['prod-filter-year', 'inv-filter-year', 'prod-daily-filter-year', 'inv-chart-filter-year'].forEach(id => { const el = document.getElementById(id); if(el) el.value = currentYear; });
            ['prod-filter-month', 'inv-filter-month', 'prod-daily-filter-month', 'inv-chart-filter-month'].forEach(id => { const el = document.getElementById(id); if(el) el.value = curMonth; });
        }

        function toggleDailyChartFilters() {
            const checked = document.getElementById('chk-daily-month').checked;
            document.getElementById('prod-daily-filter-year').disabled = !checked;
            document.getElementById('prod-daily-filter-month').disabled = !checked;
            renderDailyProductionChart();
        }

        function toggleInvChartFilters() {
            const checked = document.getElementById('chk-inv-chart-month').checked;
            document.getElementById('inv-chart-filter-year').disabled = !checked;
            document.getElementById('inv-chart-filter-month').disabled = !checked;
            renderInventoryChart();
        }

        function toggleInvForm(type) {
            const nameInput = document.getElementById('inv-name');
            const qtyLabel = document.getElementById('inv-qty-label');
            const qtyInput = document.getElementById('inv-qty');
            const bagsContainer = document.getElementById('inv-bags-container');

            if (type === '‡∏Ç‡∏≤‡∏¢‡∏≠‡∏≠‡∏Å') {
                bagsContainer.classList.remove('hidden');
                qtyLabel.innerText = '‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å‡∏à‡∏£‡∏¥‡∏á (‡∏Å‡∏¥‡πÇ‡∏•‡∏Å‡∏£‡∏±‡∏°)';
                qtyInput.placeholder = '‡∏£‡∏∞‡∏ö‡∏∏‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å‡∏ä‡∏±‡πà‡∏á‡∏à‡∏£‡∏¥‡∏á...';
                nameInput.value = '‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ'; nameInput.readOnly = true; nameInput.classList.add('bg-gray-100');
            } else {
                bagsContainer.classList.add('hidden');
                qtyLabel.innerText = '‡∏à‡∏≥‡∏ô‡∏ß‡∏ô (‡∏Å‡∏¥‡πÇ‡∏•‡∏Å‡∏£‡∏±‡∏°)';
                qtyInput.placeholder = '0.00';
                nameInput.value = ''; nameInput.readOnly = false; nameInput.classList.remove('bg-gray-100');
            }
        }

        function handleImagePreview(input) {
            const container = document.getElementById('image-preview-container');
            const placeholder = document.getElementById('image-upload-placeholder');
            container.innerHTML = '';
            currentInvImages = [];

            if (input.files && input.files.length > 0) {
                if(input.files.length > 2) {
                    Swal.fire({icon: 'error', title: '‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏î‡πâ‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î 2 ‡∏£‡∏π‡∏õ'});
                    input.value = '';
                    placeholder.classList.remove('hidden'); container.classList.add('hidden');
                    return;
                }
                placeholder.classList.add('hidden');
                container.classList.remove('hidden');
                
                Array.from(input.files).forEach(file => {
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        const img = new Image();
                        img.src = e.target.result;
                        img.onload = () => {
                            const canvas = document.createElement('canvas');
                            let width = img.width;
                            let height = img.height;
                            const MAX_WIDTH = 800;
                            if (width > height) { if (width > MAX_WIDTH) { height *= MAX_WIDTH / width; width = MAX_WIDTH; } } 
                            else { if (height > MAX_WIDTH) { width *= MAX_WIDTH / height; height = MAX_WIDTH; } }
                            
                            canvas.width = width;
                            canvas.height = height;
                            const ctx = canvas.getContext('2d');
                            ctx.drawImage(img, 0, 0, width, height);
                            const compressedBase64 = canvas.toDataURL('image/jpeg', 0.7);
                            currentInvImages.push(compressedBase64);
                            
                            const div = document.createElement('div');
                            div.className = 'relative group';
                            div.innerHTML = `<img src="${compressedBase64}" class="w-full h-24 object-cover rounded-xl border border-gray-200 shadow-sm">`;
                            container.appendChild(div);
                        };
                    };
                    reader.readAsDataURL(file);
                });
            } else {
                placeholder.classList.remove('hidden');
                container.classList.add('hidden');
            }
        }

        function openAdminImageModal(images) {
            if (!images || images.length === 0) return;
            const modal = document.getElementById('admin-image-modal');
            const container = document.getElementById('admin-image-container');
            container.innerHTML = '';
            const imgArray = Array.isArray(images) ? images : [images];
            imgArray.forEach(src => {
                const img = document.createElement('img');
                img.src = src;
                img.className = "max-w-full rounded-lg shadow-2xl border-4 border-white";
                container.appendChild(img);
            });
            modal.classList.remove('hidden');
        }

        function closeAdminImageModal() { document.getElementById('admin-image-modal').classList.add('hidden'); }

        async function fetchData(silent = false) {
            const overlay = document.getElementById('loading-overlay');
            if (!silent && overlay.classList.contains('hidden')) { overlay.classList.remove('hidden'); overlay.classList.add('flex'); }
            
            try {
                const response = await fetch(`${GOOGLE_SCRIPT_URL}?action=load&t=${Date.now()}`);
                const result = await response.json();
                if (result.success) { 
                    appData.production = result.data.production.map(r => ({
                        ...r, 
                        bags: parseInt(String(r.bags).replace(/,/g, '')) || 0, 
                        kilos: parseInt(String(r.kilos).replace(/,/g, '')) || 0,
                        accBags: r['‡∏™‡∏∞‡∏™‡∏°'] ? parseInt(String(r['‡∏™‡∏∞‡∏™‡∏°']).replace(/,/g, '')) : 0
                    }));
                    
                    appData.records = result.data.records.map(r => {
                        let imgs = [];
                        if (r.images) { try { imgs = JSON.parse(r.images); } catch(e) { imgs = [r.images]; } }
                        const cleanQty = String(r.quantity).replace(/,/g, '');
                        const cleanBags = r.bags ? String(r.bags).replace(/,/g, '') : 0;
                        return { ...r, quantity: parseFloat(cleanQty) || 0, bags: parseInt(cleanBags) || 0, images: imgs };
                    });
                    
                    if(!document.getElementById('view-production').classList.contains('hidden')) { renderProductionView(); renderDailyProductionChart(); }
                    if(!document.getElementById('view-inventory').classList.contains('hidden')) { renderInventoryView(); renderInventoryChart(); }
                }
            } catch (error) { console.log('Fetch Failed', error); } 
            finally { 
                if (!silent) { overlay.classList.add('hidden'); overlay.classList.remove('flex'); document.getElementById('loading-text').innerText = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£...'; }
            }
        }

        async function sendData(action, type, data) {
            const overlay = document.getElementById('loading-overlay');
            document.getElementById('loading-text').innerText = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...';
            overlay.classList.remove('hidden'); overlay.classList.add('flex');

            try {
                let simulatedId = "PENDING-" + Date.now(); 
                let simulatedTimestamp;

                if (action === 'edit' && data.timestamp) {
                    simulatedId = data.id;
                    simulatedTimestamp = data.timestamp;
                } else {
                    const now = new Date();
                    const utcMs = now.getTime() + (7 * 60 * 60 * 1000);
                    const thaiDate = new Date(utcMs);
                    const d = String(thaiDate.getUTCDate()); 
                    const m = String(thaiDate.getUTCMonth() + 1).padStart(2, '0');
                    const y = thaiDate.getUTCFullYear() + 543; 
                    const h = String(thaiDate.getUTCHours()).padStart(2, '0');
                    const min = String(thaiDate.getUTCMinutes()).padStart(2, '0');
                    const s = String(thaiDate.getUTCSeconds()).padStart(2, '0');
                    simulatedTimestamp = `${d}/${m}/${y}, ${h}:${min}:${s}`;
                }
                
                const payloadData = { ...data, timestamp: simulatedTimestamp };
                
                fetch(GOOGLE_SCRIPT_URL, { 
                    method: 'POST', mode: 'no-cors',
                    body: JSON.stringify({ action, type, data: payloadData }), 
                    headers: { 'Content-Type': 'application/json' } 
                });

                // UI Optimistic Update
                if (type === 'Records') {
                    if (action === 'edit') {
                        const index = appData.records.findIndex(r => r.id === data.id);
                        if (index !== -1) appData.records[index] = { ...appData.records[index], ...data };
                    } else {
                        appData.records.push({ id: simulatedId, timestamp: simulatedTimestamp, ...data });
                    }
                    renderInventoryView(); renderInventoryChart(); 
                } else if (type === 'Production') {
                    if (action === 'edit') {
                        const index = appData.production.findIndex(r => r.id === data.id);
                        if (index !== -1) appData.production[index] = { ...appData.production[index], ...data };
                    } else {
                        let latestAcc = 0;
                        if (appData.production.length > 0) latestAcc = appData.production[appData.production.length - 1].accBags || 0; 
                        appData.production.push({ id: simulatedId, timestamp: simulatedTimestamp, ...data, accBags: latestAcc + (parseInt(data.bags) || 0) });
                    }
                    renderProductionView(); renderDailyProductionChart(); 
                }

                overlay.classList.add('hidden'); overlay.classList.remove('flex');
                Swal.fire({ title: '‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', text: '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß', icon: 'success', timer: 1500, showConfirmButton: false });
                setTimeout(() => { fetchData(true); }, 1500);

            } catch (e) { 
                Swal.fire('Error', e.message, 'error');
                overlay.classList.add('hidden'); overlay.classList.remove('flex');
            }
        }

        async function handleProductionOptions(id) {
            const record = appData.production.find(r => r.id === id);
            if (!record) return;
            const { value: password } = await Swal.fire({ title: '‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏ï‡∏±‡∏ß‡∏ï‡∏ô', input: 'password', inputLabel: '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô ', inputPlaceholder: '‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô', showCancelButton: true, confirmButtonColor: '#0ea5e9', confirmButtonText: '‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô', cancelButtonText: '‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å' });
            if (password !== '4455') { if (password) Swal.fire('‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á', '', 'error'); return; }
            const { isConfirmed, isDenied } = await Swal.fire({ title: '‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£', text: '‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£', icon: 'info', showDenyButton: true, showCancelButton: true, confirmButtonText: '<i class="fa-solid fa-pen-to-square"></i> ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç', confirmButtonColor: '#f59e0b', denyButtonText: '<i class="fa-solid fa-trash-can"></i> ‡∏•‡∏ö', denyButtonColor: '#ef4444', cancelButtonText: '‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å', reverseButtons: true });
            if (isDenied) deleteData(id, 'Production', true);
            else if (isConfirmed) openEditProductionModal(record);
        }

        function openEditProductionModal(record) {
            const d = parseDate(record.timestamp);
            const dateStr = d.getFullYear() + '-' + String(d.getMonth()+1).padStart(2,'0') + '-' + String(d.getDate()).padStart(2,'0');
            const timeStr = String(d.getHours()).padStart(2,'0') + ':' + String(d.getMinutes()).padStart(2,'0');
            Swal.fire({
                title: '‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ú‡∏•‡∏¥‡∏ï',
                html: `<div class="flex flex-col gap-4 text-left"><div><label class="block text-sm font-bold text-gray-700 mb-1">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</label><input type="date" id="edit-date" class="w-full border border-gray-300 p-2 rounded-lg outline-none focus:ring-2 focus:ring-brand-500" value="${dateStr}"></div><div><label class="block text-sm font-bold text-gray-700 mb-1">‡πÄ‡∏ß‡∏•‡∏≤</label><input type="time" id="edit-time" class="w-full border border-gray-300 p-2 rounded-lg outline-none focus:ring-2 focus:ring-brand-500" value="${timeStr}"></div><div><label class="block text-sm font-bold text-gray-700 mb-1">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô (‡∏Å‡∏£‡∏∞‡∏™‡∏≠‡∏ö)</label><input type="number" id="edit-bags" class="w-full border border-gray-300 p-2 rounded-lg outline-none focus:ring-2 focus:ring-brand-500" value="${record.bags}"></div></div>`,
                showCancelButton: true, confirmButtonText: '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç', confirmButtonColor: '#059669', cancelButtonText: '‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å',
                preConfirm: () => {
                    const newDate = document.getElementById('edit-date').value;
                    const newTime = document.getElementById('edit-time').value;
                    const newBags = document.getElementById('edit-bags').value;
                    if(!newDate || !newTime || !newBags) Swal.showValidationMessage('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö');
                    return { newDate, newTime, newBags };
                }
            }).then((result) => { if (result.isConfirmed) saveProductionEdit(record.id, result.value); });
        }

        function saveProductionEdit(id, values) {
            const { newDate, newTime, newBags } = values;
            const [y, m, d] = newDate.split('-').map(Number);
            const thaiYear = y + 543;
            const [hr, min] = newTime.split(':');
            const newTimestamp = `${d}/${String(m).padStart(2,'0')}/${thaiYear}, ${hr}:${min}:00`;
            sendData('edit', 'Production', { id: id, timestamp: newTimestamp, bags: parseInt(newBags), kilos: parseInt(newBags) * 10 });
        }

        async function handleInventoryOptions(id) {
            const record = appData.records.find(r => r.id === id);
            if (!record) return;
            const { value: password } = await Swal.fire({ title: '‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏ï‡∏±‡∏ß‡∏ï‡∏ô', input: 'password', inputLabel: '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô ', inputPlaceholder: '‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô', showCancelButton: true, confirmButtonColor: '#0ea5e9', confirmButtonText: '‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô', cancelButtonText: '‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å' });
            if (password !== '4455') { if (password) Swal.fire('‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á', '', 'error'); return; }
            const { isConfirmed, isDenied } = await Swal.fire({ title: '‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤', text: '‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£', icon: 'info', showDenyButton: true, showCancelButton: true, confirmButtonText: '<i class="fa-solid fa-pen-to-square"></i> ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç', confirmButtonColor: '#f59e0b', denyButtonText: '<i class="fa-solid fa-trash-can"></i> ‡∏•‡∏ö', denyButtonColor: '#ef4444', cancelButtonText: '‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å', reverseButtons: true });
            if (isDenied) deleteData(id, 'Records', true);
            else if (isConfirmed) openEditInventoryModal(record);
        }

        function openEditInventoryModal(record) {
            const d = parseDate(record.timestamp);
            const dateStr = d.getFullYear() + '-' + String(d.getMonth()+1).padStart(2,'0') + '-' + String(d.getDate()).padStart(2,'0');
            const timeStr = String(d.getHours()).padStart(2,'0') + ':' + String(d.getMinutes()).padStart(2,'0');
            const isBuyIn = record.status === '‡∏ã‡∏∑‡πâ‡∏≠‡πÄ‡∏Ç‡πâ‡∏≤';
            let bagsInputHtml = !isBuyIn ? `<div><label class="block text-sm font-bold text-gray-700 mb-1">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô (‡∏Å‡∏£‡∏∞‡∏™‡∏≠‡∏ö)</label><input type="number" id="edit-inv-bags" class="w-full border border-gray-300 p-2 rounded-lg outline-none focus:ring-2 focus:ring-brand-500" value="${record.bags || 0}"></div>` : '';

            Swal.fire({
                title: '‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤',
                html: `<div class="flex flex-col gap-4 text-left"><div class="bg-gray-50 p-3 rounded-lg border border-gray-200"><p class="text-sm text-gray-500">‡∏ä‡∏∑‡πà‡∏≠‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</p><p class="font-bold text-gray-800">${record.name} (${record.status})</p></div><div class="grid grid-cols-2 gap-4"><div><label class="block text-sm font-bold text-gray-700 mb-1">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</label><input type="date" id="edit-inv-date" class="w-full border border-gray-300 p-2 rounded-lg outline-none focus:ring-2 focus:ring-brand-500" value="${dateStr}"></div><div><label class="block text-sm font-bold text-gray-700 mb-1">‡πÄ‡∏ß‡∏•‡∏≤</label><input type="time" id="edit-inv-time" class="w-full border border-gray-300 p-2 rounded-lg outline-none focus:ring-2 focus:ring-brand-500" value="${timeStr}"></div></div><div class="grid ${isBuyIn ? 'grid-cols-1' : 'grid-cols-2'} gap-4"><div><label class="block text-sm font-bold text-gray-700 mb-1">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô (KG)</label><input type="number" id="edit-inv-qty" step="0.01" class="w-full border border-gray-300 p-2 rounded-lg outline-none focus:ring-2 focus:ring-brand-500" value="${record.quantity}"></div>${bagsInputHtml}</div></div>`,
                showCancelButton: true, confirmButtonText: '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç', confirmButtonColor: '#059669', cancelButtonText: '‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å',
                preConfirm: () => {
                    const newDate = document.getElementById('edit-inv-date').value;
                    const newTime = document.getElementById('edit-inv-time').value;
                    const newQty = document.getElementById('edit-inv-qty').value;
                    const bagsInput = document.getElementById('edit-inv-bags');
                    const newBags = bagsInput ? bagsInput.value : 0;
                    if(!newDate || !newTime || !newQty) Swal.showValidationMessage('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö');
                    return { newDate, newTime, newQty, newBags };
                }
            }).then((result) => { if (result.isConfirmed) saveInventoryEdit(record.id, result.value); });
        }

        function saveInventoryEdit(id, values) {
            const { newDate, newTime, newQty, newBags } = values;
            const [y, m, d] = newDate.split('-').map(Number);
            const thaiYear = y + 543;
            const [hr, min] = newTime.split(':');
            const newTimestamp = `${d}/${String(m).padStart(2,'0')}/${thaiYear}, ${hr}:${min}:00`;
            sendData('edit', 'Records', { id: id, timestamp: newTimestamp, quantity: parseFloat(newQty), bags: parseInt(newBags) || 0 });
        }

        async function deleteData(id, type, skipConfirm = false) {
            let password = '4455';
            if (!skipConfirm) {
                const result = await Swal.fire({ title: '‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö', input: 'password', inputLabel: '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô ', inputPlaceholder: '‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô', showCancelButton: true, confirmButtonColor: '#ef4444', confirmButtonText: '‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•', cancelButtonText: '‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å' });
                if (!result.isConfirmed) return;
                password = result.value;
            }

            if (password === '4455') {
                const overlay = document.getElementById('loading-overlay');
                document.getElementById('loading-text').innerText = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...';
                overlay.classList.remove('hidden'); overlay.classList.add('flex');
                
                if (id.toString().startsWith('PENDING-')) {
                     // Smart Delete logic for pending items... (simplified for brevity)
                     const dataArray = (type === 'Records') ? appData.records : appData.production;
                     if (type === 'Records') appData.records = appData.records.filter(r => r.id !== id);
                     else appData.production = appData.production.filter(r => r.id !== id);
                } else {
                    fetch(GOOGLE_SCRIPT_URL, { method: 'POST', mode: 'no-cors', body: JSON.stringify({ action: 'delete', type, data: { id } }) });
                    if (type === 'Records') appData.records = appData.records.filter(r => r.id !== id);
                    else appData.production = appData.production.filter(r => r.id !== id);
                }

                if (type === 'Records') { renderInventoryView(); renderInventoryChart(); } 
                else { renderProductionView(); renderDailyProductionChart(); }

                overlay.classList.add('hidden'); overlay.classList.remove('flex');
                if (!skipConfirm) Swal.fire({title: '‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', icon: 'success', timer: 1000, showConfirmButton: false});
            } else if (password) {
                Swal.fire('‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á', '', 'error');
            }
        }

        function submitProduction() {
            const qty = document.getElementById('input-prod-today').value;
            if (!qty || qty <= 0) return Swal.fire({title: '‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô', text: '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏∞‡∏ö‡∏∏‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Å‡∏£‡∏∞‡∏™‡∏≠‡∏ö‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á', icon: 'warning', confirmButtonColor: '#0ea5e9'});
            Swal.fire({ title: '‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å', html: `<p class="text-lg">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô: <b>${qty}</b> ‡∏Å‡∏£‡∏∞‡∏™‡∏≠‡∏ö</p><p class="text-sm text-gray-500">(${qty * 10} ‡∏Å‡∏¥‡πÇ‡∏•‡∏Å‡∏£‡∏±‡∏°)</p>`, icon: 'question', showCancelButton: true, confirmButtonColor: '#059669', confirmButtonText: '‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô' }).then((result) => {
                if (result.isConfirmed) {
                    sendData('add', 'Production', { bags: parseInt(qty), kilos: parseInt(qty) * 10 });
                    document.getElementById('input-prod-today').value = '';
                }
            });
        }

        function submitInventory(e) {
            e.preventDefault();
            const type = document.getElementById('inv-type').value;
            let name = document.getElementById('inv-name').value;
            let inputQty = parseFloat(document.getElementById('inv-qty').value); 
            
            if (!type || !name) return Swal.fire({title: '‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô', text: '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö', icon: 'warning', confirmButtonColor: '#0ea5e9'});
            
            let bagsVal = 0;
            let displayHtml = '';

            if (type === '‡∏Ç‡∏≤‡∏¢‡∏≠‡∏≠‡∏Å') {
                const inputBags = parseInt(document.getElementById('inv-bags-input').value);
                if (!inputBags || inputBags <= 0) return Swal.fire({title: '‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô', text: '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏∞‡∏ö‡∏∏‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Å‡∏£‡∏∞‡∏™‡∏≠‡∏ö‡∏ó‡∏µ‡πà‡∏Ç‡∏≤‡∏¢', icon: 'warning', confirmButtonColor: '#0ea5e9'});
                if (!inputQty) return Swal.fire({title: '‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô', text: '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏∞‡∏ö‡∏∏‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å‡∏à‡∏£‡∏¥‡∏á', icon: 'warning', confirmButtonColor: '#0ea5e9'});
                const stockBags = calculateReadyStockBags();
                if (inputBags > stockBags) return Swal.fire({ title: '‡∏™‡∏ï‡πá‡∏≠‡∏Å‡πÑ‡∏°‡πà‡πÄ‡∏û‡∏µ‡∏¢‡∏á‡∏û‡∏≠', text: `‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏°‡∏µ‡πÄ‡∏û‡∏µ‡∏¢‡∏á ${stockBags.toLocaleString()} ‡∏Å‡∏£‡∏∞‡∏™‡∏≠‡∏ö ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏Ç‡∏≤‡∏¢‡∏≠‡∏≠‡∏Å ${inputBags.toLocaleString()} ‡∏Å‡∏£‡∏∞‡∏™‡∏≠‡∏ö‡πÑ‡∏î‡πâ`, icon: 'error', confirmButtonColor: '#0ea5e9' }); 
                bagsVal = inputBags;
                displayHtml = `<div class="bg-blue-50 p-4 rounded-xl border border-blue-100 mb-2"><p class="text-xl font-bold text-blue-900 mb-1">‡∏Ç‡∏≤‡∏¢‡∏≠‡∏≠‡∏Å: ${inputBags.toLocaleString()} ‡∏Å‡∏£‡∏∞‡∏™‡∏≠‡∏ö</p><p class="text-gray-600">‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å‡∏à‡∏£‡∏¥‡∏á: ${inputQty.toLocaleString()} ‡∏Å‡∏¥‡πÇ‡∏•‡∏Å‡∏£‡∏±‡∏°</p></div>`;
            } else {
                if (!inputQty) return Swal.fire({title: '‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô', text: '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏∞‡∏ö‡∏∏‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Å‡∏¥‡πÇ‡∏•‡∏Å‡∏£‡∏±‡∏°', icon: 'warning', confirmButtonColor: '#0ea5e9'});
                displayHtml = `<p class="text-lg">‡∏ã‡∏∑‡πâ‡∏≠‡πÄ‡∏Ç‡πâ‡∏≤: <b>${inputQty.toLocaleString()}</b> ‡∏Å‡∏¥‡πÇ‡∏•‡∏Å‡∏£‡∏±‡∏°</p>`;
            }

            Swal.fire({ title: '‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å', html: displayHtml, icon: 'question', showCancelButton: true, confirmButtonColor: '#059669', confirmButtonText: '‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô', cancelButtonText: '‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å' }).then((result) => {
                if (result.isConfirmed) {
                    sendData('add', 'Records', { status: type, name: name, quantity: inputQty, bags: bagsVal, images: currentInvImages });
                    e.target.reset();
                    document.getElementById('image-preview-container').innerHTML = '';
                    document.getElementById('image-upload-placeholder').classList.remove('hidden');
                    document.getElementById('inv-bags-container').classList.add('hidden'); 
                    currentInvImages = [];
                }
            });
        }

        // Render Functions
        function renderProductionView() {
            const today = new Date().toDateString();
            const thisMonth = new Date().getMonth();
            const thisYear = new Date().getFullYear();
            let dCount = 0, mCount = 0;
            appData.production.forEach(r => {
                const d = parseDate(r.timestamp);
                if (d.toDateString() === today) dCount += r.bags;
                if (d.getMonth() === thisMonth && d.getFullYear() === thisYear) mCount += r.bags;
            });
            document.getElementById('prod-today').innerText = dCount.toLocaleString();
            document.getElementById('prod-month').innerText = mCount.toLocaleString();
            document.getElementById('prod-stock').innerText = calculateReadyStockBags().toLocaleString();

            const fYear = document.getElementById('prod-filter-year').value;
            const fMonth = document.getElementById('prod-filter-month').value;
            const tbody = document.getElementById('table-production-body'); 
            tbody.innerHTML = '';
            
            let filtered = appData.production;
            if(fYear) filtered = filtered.filter(r => parseDate(r.timestamp).getFullYear() == fYear);

            if(fMonth) {
                filtered = filtered.filter(r => parseDate(r.timestamp).getMonth() + 1 == fMonth);
                filtered.sort((a,b) => parseDate(b.timestamp) - parseDate(a.timestamp));
                filtered.forEach(r => {
                    const d = parseDate(r.timestamp);
                    const ds = `${d.getDate().toString().padStart(2,'0')}/${(d.getMonth()+1).toString().padStart(2,'0')}/${d.getFullYear()+543} ${String(d.getHours()).padStart(2,'0')}:${String(d.getMinutes()).padStart(2,'0')}:${String(d.getSeconds()).padStart(2,'0')} ‡∏ô.`;
                    tbody.innerHTML += `<tr class="border-b border-gray-50 hover:bg-gray-50"><td class="p-4 text-center">${ds}</td><td class="p-4 text-center font-bold text-gray-800">${r.bags.toLocaleString()} ‡∏Å‡∏£‡∏∞‡∏™‡∏≠‡∏ö</td><td class="p-4 text-center font-bold text-gray-800">${r.kilos.toLocaleString()} ‡∏Å‡∏¥‡πÇ‡∏•‡∏Å‡∏£‡∏±‡∏°</td><td class="p-4 text-center"><button onclick="handleProductionOptions('${r.id}')" class="w-10 h-10 bg-gray-100 hover:bg-gray-200 text-gray-600 rounded-full mx-auto"><i class="fa-solid fa-gear"></i></button></td></tr>`;
                });
            } else {
                const groups = {};
                filtered.forEach(r => {
                     const d = parseDate(r.timestamp);
                     const key = `${d.getFullYear()}-${d.getMonth()}`;
                     if(!groups[key]) groups[key] = { year: d.getFullYear(), month: d.getMonth(), bags: 0, kilos: 0, count: 0 };
                     groups[key].bags += r.bags; groups[key].kilos += r.kilos; groups[key].count++;
                });
                Object.values(groups).sort((a,b) => (a.year !== b.year ? b.year - a.year : b.month - a.month)).forEach(g => {
                    tbody.innerHTML += `<tr class="border-b border-gray-50 hover:bg-gray-50"><td class="p-4 text-center">${getThaiMonthName(g.month + 1)} ${g.year + 543}</td><td class="p-4 text-center font-bold text-gray-800">${g.bags.toLocaleString()} ‡∏Å‡∏£‡∏∞‡∏™‡∏≠‡∏ö</td><td class="p-4 text-center font-bold text-gray-800">${g.kilos.toLocaleString()} ‡∏Å‡∏¥‡πÇ‡∏•‡∏Å‡∏£‡∏±‡∏°</td><td class="p-4 text-center">(${g.count} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£)</td></tr>`;
                });
            }
        }

        function renderDailyProductionChart() {
            const rawData = appData.production;
            const useMonth = document.getElementById('chk-daily-month').checked;
            const yearVal = parseInt(document.getElementById('prod-daily-filter-year').value) || new Date().getFullYear();
            const monthVal = document.getElementById('prod-daily-filter-month').value;
            const isAllMonths = monthVal === 'all';
            
            let categories = [], data = [], scrollable = false;

            if (!useMonth) {
                const yearMap = {};
                rawData.forEach(item => { const y = parseDate(item.timestamp).getFullYear(); yearMap[y] = (yearMap[y] || 0) + item.bags; });
                Object.keys(yearMap).sort().forEach(y => { categories.push(parseInt(y)+543); data.push(yearMap[y]); });
            } else if (isAllMonths) {
                const monthMap = {};
                rawData.forEach(item => { const d = parseDate(item.timestamp); if(d.getFullYear()===yearVal) monthMap[d.getMonth()] = (monthMap[d.getMonth()]||0)+item.bags; });
                for(let i=0;i<12;i++) { categories.push(getThaiMonthName(i+1)); data.push(monthMap[i]||0); }
            } else {
                const month = parseInt(monthVal);
                const daysInMonth = new Date(yearVal, month, 0).getDate();
                for(let i=1; i<=daysInMonth; i++) {
                    const dateKey = `${yearVal}-${String(month).padStart(2,'0')}-${String(i).padStart(2,'0')}`;
                    const dayTotal = rawData.reduce((sum, item) => {
                        const d = parseDate(item.timestamp);
                        return (d.getFullYear()===yearVal && d.getMonth()+1===month && d.getDate()===i) ? sum + item.bags : sum;
                    }, 0);
                    categories.push(String(i).padStart(2,'0'));
                    data.push(dayTotal);
                }
                scrollable = true;
            }
            renderApexChart(categories, data, scrollable, '#chart-daily-y', '#chart-daily-production', '#daily-chart-scroller', '#8b5cf6');
        }

        function renderInventoryView() {
            const thisMonth = new Date().getMonth(), thisYear = new Date().getFullYear();
            let inKg = 0, outKg = 0;
            appData.records.forEach(r => { const d = parseDate(r.timestamp); if(d.getMonth()===thisMonth && d.getFullYear()===thisYear) { if(r.status==='‡∏ã‡∏∑‡πâ‡∏≠‡πÄ‡∏Ç‡πâ‡∏≤') inKg+=r.quantity; else outKg+=r.quantity; }});
            document.getElementById('inv-in').innerText = inKg.toLocaleString();
            document.getElementById('inv-out').innerText = outKg.toLocaleString();
            document.getElementById('inv-stock').innerText = calculateReadyStockBags().toLocaleString();
            
            const totalBuy = appData.records.filter(r=>r.status==='‡∏ã‡∏∑‡πâ‡∏≠‡πÄ‡∏Ç‡πâ‡∏≤').reduce((s,r)=>s+(r.quantity||0),0);
            const totalUsed = appData.production.reduce((s,r)=>s+(r.kilos||0),0);
            document.getElementById('inv-raw-material').innerText = (22719 + totalBuy - totalUsed).toLocaleString();

            const fYear = document.getElementById('inv-filter-year').value;
            const fMonth = document.getElementById('inv-filter-month').value;
            const fStatus = document.getElementById('inv-filter-status').value;
            
            let filtered = appData.records;
            if(fYear) filtered = filtered.filter(r => parseDate(r.timestamp).getFullYear() == fYear);
            if(fMonth) filtered = filtered.filter(r => parseDate(r.timestamp).getMonth() + 1 == fMonth);
            if(fStatus) filtered = filtered.filter(r => r.status == fStatus);

            const tbody = document.getElementById('table-inv-body'); tbody.innerHTML = '';
            if(fMonth) {
                filtered.sort((a,b) => parseDate(b.timestamp) - parseDate(a.timestamp));
                filtered.forEach(r => {
                    const d = parseDate(r.timestamp);
                    const ds = `${d.getDate().toString().padStart(2,'0')}/${(d.getMonth()+1).toString().padStart(2,'0')}/${d.getFullYear()+543} ${String(d.getHours()).padStart(2,'0')}:${String(d.getMinutes()).padStart(2,'0')}:${String(d.getSeconds()).padStart(2,'0')} ‡∏ô.`;
                    const detailBtn = r.images && r.images.length > 0 ? `<button onclick='openAdminImageModal(${JSON.stringify(r.images)})' class="text-brand-600 hover:underline"><i class="fa-solid fa-circle-info"></i> ‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î</button>` : `<span class="text-gray-400">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û</span>`;
                    const amountHtml = r.status === '‡∏Ç‡∏≤‡∏¢‡∏≠‡∏≠‡∏Å' ? `<span class="text-blue-700 font-bold">${r.quantity.toLocaleString()} KG</span><div class="text-xs text-gray-500">(${r.bags ? r.bags.toLocaleString() : (r.quantity/10).toLocaleString()} ‡∏Å‡∏£‡∏∞‡∏™‡∏≠‡∏ö)</div>` : `<span class="text-gray-800 font-bold">${r.quantity.toLocaleString()} KG</span>`;
                    tbody.innerHTML += `<tr class="border-b border-gray-50 hover:bg-gray-50"><td class="p-4 whitespace-nowrap">${ds}</td><td class="p-4"><div>${r.name}</div><span class="text-xs px-2 py-0.5 rounded border ${r.status==='‡∏ã‡∏∑‡πâ‡∏≠‡πÄ‡∏Ç‡πâ‡∏≤'?'bg-green-50 text-green-700':'bg-blue-50 text-blue-700'}">${r.status}</span></td><td class="p-4 text-center">${amountHtml}</td><td class="p-4 text-center">${detailBtn}</td><td class="p-4 text-center"><button onclick="handleInventoryOptions('${r.id}')" class="w-10 h-10 bg-gray-100 hover:bg-gray-200 text-gray-600 rounded-full mx-auto"><i class="fa-solid fa-gear"></i></button></td></tr>`;
                });
            } else {
                const monthlyData = {};
                filtered.forEach(r => { const d = parseDate(r.timestamp); const key = `${d.getFullYear()}-${d.getMonth()}`; if(!monthlyData[key]) monthlyData[key]={year:d.getFullYear(),month:d.getMonth(),buy:0,sell:0,count:0}; if(r.status==='‡∏ã‡∏∑‡πâ‡∏≠‡πÄ‡∏Ç‡πâ‡∏≤') monthlyData[key].buy+=r.quantity; else monthlyData[key].sell+=r.quantity; monthlyData[key].count++; });
                Object.values(monthlyData).sort((a,b) => b.month - a.month).forEach(m => {
                    const summary = (m.buy>0?`<div class="text-green-700">‡πÄ‡∏Ç‡πâ‡∏≤: ${m.buy.toLocaleString()}</div>`:'') + (m.sell>0?`<div class="text-blue-700">‡∏≠‡∏≠‡∏Å: ${m.sell.toLocaleString()}</div>`:'');
                    tbody.innerHTML += `<tr class="border-b border-gray-50 hover:bg-gray-50"><td class="p-4 font-bold">${getThaiMonthName(m.month+1)} ${m.year+543}</td><td class="p-4"><span class="bg-gray-100 px-2 py-1 rounded text-xs">‡∏™‡∏£‡∏∏‡∏õ‡∏¢‡∏≠‡∏î</span></td><td class="p-4 text-center">${summary||'-'}</td><td class="p-4 text-center text-gray-500">${m.count} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</td><td></td></tr>`;
                });
            }
        }

        function renderInventoryChart() {
            const rawData = appData.records || [];
            const useMonth = document.getElementById('chk-inv-chart-month').checked;
            const yearVal = parseInt(document.getElementById('inv-chart-filter-year').value) || new Date().getFullYear();
            const monthVal = document.getElementById('inv-chart-filter-month').value;
            const statusVal = document.getElementById('inv-chart-filter-status').value;
            const isAllMonths = monthVal === 'all';

            let categories = [], buyData = [], sellData = [], scrollable = false;

            if (!useMonth) {
                const yearMap = {};
                rawData.forEach(r => { if(statusVal && r.status!==statusVal)return; const y=parseDate(r.timestamp).getFullYear(); if(!yearMap[y])yearMap[y]={buy:0,sell:0}; if(r.status==='‡∏ã‡∏∑‡πâ‡∏≠‡πÄ‡∏Ç‡πâ‡∏≤')yearMap[y].buy+=r.quantity; else yearMap[y].sell+=r.quantity; });
                Object.keys(yearMap).sort().forEach(y => { categories.push(parseInt(y)+543); buyData.push(yearMap[y].buy); sellData.push(yearMap[y].sell); });
            } else if (isAllMonths) {
                const monthMap = {};
                rawData.forEach(r => { if(statusVal && r.status!==statusVal)return; const d=parseDate(r.timestamp); if(d.getFullYear()===yearVal){ const m=d.getMonth(); if(!monthMap[m])monthMap[m]={buy:0,sell:0}; if(r.status==='‡∏ã‡∏∑‡πâ‡∏≠‡πÄ‡∏Ç‡πâ‡∏≤')monthMap[m].buy+=r.quantity; else monthMap[m].sell+=r.quantity; } });
                for(let i=0;i<12;i++) { categories.push(getThaiMonthName(i+1)); const d=monthMap[i]||{buy:0,sell:0}; buyData.push(d.buy); sellData.push(d.sell); }
            } else {
                const month = parseInt(monthVal);
                const daysInMonth = new Date(yearVal, month, 0).getDate();
                for(let i=1; i<=daysInMonth; i++) {
                    const dayTotal = rawData.reduce((acc, r) => {
                        const d = parseDate(r.timestamp);
                        if ((!statusVal || r.status===statusVal) && d.getFullYear()===yearVal && d.getMonth()+1===month && d.getDate()===i) {
                            if(r.status==='‡∏ã‡∏∑‡πâ‡∏≠‡πÄ‡∏Ç‡πâ‡∏≤') acc.buy+=r.quantity; else acc.sell+=r.quantity;
                        }
                        return acc;
                    }, {buy:0, sell:0});
                    categories.push(String(i).padStart(2,'0'));
                    buyData.push(dayTotal.buy);
                    sellData.push(dayTotal.sell);
                }
                scrollable = true;
            }
            renderApexInventoryChart(categories, buyData, sellData, scrollable);
        }

        function renderApexChart(categories, data, isScrollable, ySelector, mainSelector, scrollerSelector, color) {
            let maxVal = Math.max(...data); maxVal = maxVal > 0 ? Math.ceil(maxVal / 10) * 10 : 10;
            if (charts.dailyProduction) charts.dailyProduction.destroy(); if (charts.dailyY) charts.dailyY.destroy();
            
            const scroller = document.querySelector(scrollerSelector);
            let width = '100%';
            if (isScrollable) {
                const barWidth = scroller.clientWidth / 8;
                width = Math.max(scroller.clientWidth, categories.length * barWidth);
            }

            charts.dailyY = new ApexCharts(document.querySelector(ySelector), {
                series: [{data}], chart: {type:'bar',height:'100%',width:'100%',toolbar:{show:false}},
                colors: ['transparent'], plotOptions:{bar:{columnWidth:'0%'}}, grid:{show:false,padding:{left:10}},
                yaxis: {min:0, max:maxVal, tickAmount:5, labels:{formatter:(v)=>v.toFixed(0), style:{fontSize:'16px',fontWeight:700,colors:'#64748b'}, align:'right', offsetX:-15}}
            });
            charts.dailyY.render();

            charts.dailyProduction = new ApexCharts(document.querySelector(mainSelector), {
                series: [{name:'‡∏à‡∏≥‡∏ô‡∏ß‡∏ô',data}], chart:{type:'bar',height:'100%',width:width,toolbar:{show:false},zoom:{enabled:false}},
                colors:[color], plotOptions:{bar:{borderRadius:4,columnWidth:'60%',dataLabels:{position:'center'}}},
                dataLabels:{enabled:true,style:{colors:['#000'],fontWeight:700},formatter:(v)=>v>0?v:""},
                xaxis:{categories, axisBorder:{show:true}, axisTicks:{show:false}}, yaxis:{show:false,min:0,max:maxVal,tickAmount:5},
                grid:{borderColor:'#cbd5e1',strokeDashArray:4,padding:{left:20,right:20}}
            });
            charts.dailyProduction.render();
            if(isScrollable) scroller.scrollLeft = 0;
        }

        function renderApexInventoryChart(categories, buyData, sellData, isScrollable) {
            let maxVal = Math.max(...buyData, ...sellData); maxVal = maxVal > 0 ? Math.ceil(maxVal / 100) * 100 : 100;
            if (charts.invMain) charts.invMain.destroy(); if (charts.invY) charts.invY.destroy();
            
            const scroller = document.getElementById('inventory-chart-scroller');
            let width = '100%';
            if (isScrollable) {
                const barWidth = scroller.clientWidth / 5;
                width = Math.max(scroller.clientWidth, categories.length * barWidth);
            }

            charts.invY = new ApexCharts(document.querySelector("#chart-inventory-y"), {
                series: [{data:buyData}], chart:{type:'bar',height:'100%',width:'100%',toolbar:{show:false}},
                colors:['transparent'], plotOptions:{bar:{columnWidth:'0%'}}, grid:{show:false,padding:{left:10}},
                yaxis:{min:0,max:maxVal,tickAmount:5,labels:{formatter:(v)=>v.toLocaleString(),style:{fontSize:'16px',fontWeight:700,colors:'#64748b'},align:'right',offsetX:-15}}
            });
            charts.invY.render();

            charts.invMain = new ApexCharts(document.querySelector("#chart-inventory"), {
                series: [{name:'‡∏ã‡∏∑‡πâ‡∏≠‡πÄ‡∏Ç‡πâ‡∏≤',data:buyData}, {name:'‡∏Ç‡∏≤‡∏¢‡∏≠‡∏≠‡∏Å',data:sellData}],
                chart:{type:'bar',height:'100%',width:width,toolbar:{show:false},stacked:false,zoom:{enabled:false}},
                colors:['#22c55e','#3b82f6'], plotOptions:{bar:{borderRadius:4,columnWidth:'80%',dataLabels:{position:'center'}}},
                dataLabels:{enabled:true,style:{colors:['#000'],fontWeight:700},formatter:(v)=>v>0?v.toLocaleString():""},
                xaxis:{categories,axisBorder:{show:true},axisTicks:{show:false}}, yaxis:{show:false,min:0,max:maxVal,tickAmount:5},
                grid:{borderColor:'#cbd5e1',strokeDashArray:4,padding:{left:20,right:20}}, legend:{show:false}
            });
            charts.invMain.render();
            if(isScrollable) scroller.scrollLeft = 0;
        }

        // Init Hash Detection
        // Auto-open on load for Admin Dashboard
        document.addEventListener('DOMContentLoaded', () => {
            openAdminModal();
        });
    </script>
</body>
</html>
